var $jsonp=function(){var e={};return e.index=0,e.send=function(e,i){var t="__jsonp_callback_"+this.index,n=i.onSuccess||function(){},o=i.onTimeout||function(){},a=i.timeout||10,l=window.setTimeout(function(){window[t]=function(){},o()},1e3*a);window[t]=function(e){window.clearTimeout(l),n(e)};var d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=e+(e.indexOf("?")===-1?"?":"&")+"callback="+t,document.getElementsByTagName("head")[0].appendChild(d),this.index++},e}(),$=jQuery;$.Deferred||$.extend({Deferred:function(){this.reject=this.promise=this.resolve=function(){}}}),$(function(){var e=$(".flockler-wall-widget-container .flockler-wall"),i=$(".flockler-post-single-container");if(e.length||i.length){var t=new RegExp("^\\d+$"),n=new RegExp("^\\d+(.\\d+)?%$"),o=function(e){e.find(".flockler-wall-item__media img, .flockler-wall-item__video img, .flockler-wall-item__body img, .flockler-wall-item__link-preview img").not(".image-loaded").each(function(i,t){imagesLoaded(t,function(){e.msnry.layout(),$(t).addClass("image-loaded")})})},a=function(e,i,t){$.fn.on?$(document).on(e,i,t):$.fn.delegate?$(document).delegate(i,e,t):$.fn.live&&$(i).live(e,t)};e.each(function(e,i){var a=$(i),l=a.data("flockler-item-count");t.test(l)||(l=10);var d=a.data("flockler-webhook-id"),c=a.data("flockler-site-id"),r=a.data("flockler-section-id");if(!d&&!c&&!r)return void(window.console&&window.console.error&&window.console.error("Load more failed! No webhook, site or section ID found."));var s=a.find(".flockler-wall-item").length,f=a.data("initial-max-post-id"),m={itemSelector:".flockler-wall-item"},u=a.data("flockler-item-width");if(t.test(u))m.isFitWidth=!0,m.columnWidth=parseInt(u);else if(n.test(u)){var _=parseFloat(u.substr(0,u.length-1)),h=Math.floor(100/_),w=(100-h*_)/2;a.find(".flockler-wall__items").css({paddingLeft:w+"%",paddingRight:w+"%"}),m.isFitWidth=!1}else"css-percentage"===u?m.isFitWidth=!1:"css-fixed"===u?m.isFitWidth=!0:(m.isFitWidth=!0,m.columnWidth=346);var v=ajaxData.ajax_url+"?action=flockler_get_posts&count="+l+"&offset="+s+"&max_id="+f+"&width="+u;d&&(v=v+"&hook_id="+d),c&&(v=v+"&site_id="+c),r&&(v=v+"&section_id="+r),a.msnry=new Masonry(a.find(".flockler-wall__items")[0],m),o(a);var k=function(e,i){e=e instanceof Function?e:function(){},$jsonp.send(v,{onSuccess:function(i){a.find(".flockler-wall__items").append(i.articles.join("")),o(a),a.msnry.reloadItems(),a.msnry.layout(),v=i.pagination.older,(null===v||i.meta.count<l)&&a.find(".flockler-wall__load-more-btn").hide(),e()},onTimeout:i})};a.find(".flockler-wall__load-more-btn").click(function(e){var i=$(this);if(!i.hasClass("loading")){i.addClass("loading");var t=function(){i.removeClass("loading")};k(t,t)}})}),$(".flockler-article__fb-attachment__link__cover").each(function(e,i){var t=$(this),n=t.find("img"),o=n[0];imagesLoaded(o,function(){o.width>460?t.addClass("flockler-article__fb-attachment__link__cover--large"):t.addClass("flockler-article__fb-attachment__link__cover--small")})}),a("click",".flockler-wall-item__media__video-icon",function(){var e=$(this);if(e.hasClass("html5-embed")){e.parent().find("img").addClass("hide");var i=e.parent().eq(0).append('<video controls><source type="video/mp4" src="'+e.data("videosrc")+'"></source></video>');i.find("video")[0].play()}else e.hasClass("embed")&&(e.parent().find("img").addClass("hide"),e.oembed(e.data("videosrc"),{vimeo:{autoplay:!0},youtube:{autoplay:1},afterEmbed:function(){window.FB&&window.FB.XFBML&&FB.XFBML.parse()}}))})}});